# platform/monitoring/values.yaml

# 1. Grafana Configuration
grafana:
  enabled: true
  adminPassword: "admin"  # Change this on first login!
  
  ingress:
    enabled: true
    ingressClassName: alb
    annotations:
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/subnets: subnet-0a6bf732901bb35e8, subnet-066b28455fe0a88d1
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}]'
    hosts:
      - ""
    path: /

  # Persistence (Save Dashboards/Users)
  persistence:
    enabled: true
    type: statefulset
    storageClassName: "gp2"
    size: 10Gi

  defaultConfig:
    livenessProbe:
      initialDelaySeconds: 45
    readinessProbe:
      initialDelaySeconds: 45

# 2. Prometheus Configuration
prometheus:
  enabled: true
  prometheusSpec:
    # Resource Limits (Critical for stability)
    resources:
      requests:
        memory: 256Mi
        cpu: 100m
      limits:
        memory: 1Gi
        cpu: 500m

    # Persistence (Save Metrics Data)
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: "gp2"
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 10Gi  # Metrics eat space fast!
    
    # Critical: Allow Prometheus to find ServiceMonitors in other namespaces
    # (e.g., Vault in 'vault' ns, Istio in 'istio-system' ns)
    serviceMonitorSelectorNilUsesHelmValues: false
    serviceMonitorNamespaceSelector: {}
    podMonitorSelectorNilUsesHelmValues: false
    podMonitorNamespaceSelector: {}

# 3. Alertmanager Configuration
alertmanager:
  enabled: true
  alertmanagerSpec:
    storage:
      volumeClaimTemplate:
        spec:
          storageClassName: "gp2"
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 10Gi
